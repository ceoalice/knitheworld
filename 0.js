(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{306:function(e,t,o){"use strict";o.r(t);var c=o(6),a=o.n(c),r=o(16),n=o.n(r),l=o(14),m=o.n(l),u=o(15),s=o.n(u),i=o(52),g=o(36),I='<xml>\n  <block type="event_whenstarted" deletable="false" x="25" y="50">\n  </block>\n</xml>',v=function(){function e(){(m()(this,e),console.log("GOT HERE"),null===localStorage.getItem("autoincrementID")&&localStorage.setItem("autoincrementID",1),null===localStorage.getItem("userID"))?g.default.firestore().collection("users").add({joined:new Date}).then((function(e){localStorage.setItem("userID",e.id),console.log("Document written with ID: ",e.id)})).catch((function(e){console.error("Error adding document: ",e)})):console.log("Document found with ID: ",localStorage.getItem("userID"))}var t;return s()(e,[{key:"setVM",value:function(e){this.vm=e}},{key:"getCurrentProjectID",value:function(){return localStorage.getItem("currentID")}},{key:"getProjectIDs",value:function(){var e=localStorage.getItem("projectIDs");return null===e?[]:JSON.parse("[".concat(e,"]"))}},{key:"reduceSize",value:function(e){return e.replace(/(\s\s|\t|\n)/g,"")}},{key:"getXML",value:function(){return i.default.getXML().replace(/(\s\s|\t|\n)/g,"")}},{key:"getProject",value:function(e){var t=localStorage.getItem("".concat(e,"_").concat("projectXml")),o=localStorage.getItem("".concat(e,"_").concat("projectName")),c=localStorage.getItem("".concat(e,"_").concat("projectTimestamp")),a=localStorage.getItem("".concat(e,"_").concat("projectImgData"));return{id:e,xml:t,name:o,timestamp:c,imgData:a,size:Number(new Blob([t+a+c+o]).size)}}},{key:"getProjects",value:function(){var e=this,t=[];return this.getProjectIDs().forEach((function(o){t.push(e.getProject(o))})),t}},{key:"saveProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===localStorage.getItem("currentID")?this.saveNewProject(e,t):this.saveCurrentProject(e,t),this.addProjectToFirestore()}},{key:"saveNewProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=Number(localStorage.getItem("autoincrementID")),c=this.getProjectIDs();c.push(o),localStorage.setItem("currentID",o),localStorage.setItem("projectIDs",c),localStorage.setItem("autoincrementID",o+1),localStorage.setItem("".concat(o,"_").concat("projectXml"),this.getXML()),localStorage.setItem("".concat(o,"_").concat("projectTimestamp"),new Date),localStorage.setItem("".concat(o,"_").concat("projectName"),e||"Project ".concat(o)),this.vm.emit("PROJECT_NAME_CHANGED"),t&&localStorage.setItem("".concat(o,"_").concat("projectImgData"),t)}},{key:"saveCurrentProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=Number(localStorage.getItem("currentID"));localStorage.setItem("".concat(o,"_").concat("projectXml"),this.getXML()),localStorage.setItem("".concat(o,"_").concat("projectTimestamp"),new Date),e&&(localStorage.setItem("".concat(o,"_").concat("projectName"),e),this.vm.emit("PROJECT_NAME_CHANGED")),t&&localStorage.setItem("".concat(o,"_").concat("projectImgData"),t)}},{key:"addProjectToFirestore",value:function(){var e=Number(localStorage.getItem("currentID")),t=localStorage.getItem("userID"),o=g.default.firestore(),c=Object.assign({},this.getProject(e),{userID:t});o.collection("projects").add(c).then((function(e){console.log("saved doc in firestore")}))}},{key:"newProject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e?i.default.loadWorkspace(I):this.vm.emit("PROJECT_LOADING",i.default.loadWorkspace(e)),localStorage.removeItem("currentID"),this.vm.emit("PROJECT_NAME_CHANGED")}},{key:"loadProject",value:(t=n()(a.a.mark((function e(t){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.setItem("currentID",t),o=this.getProject(t),this.vm.emit("PROJECT_LOADING"),this.vm.emit("PROJECT_NAME_CHANGED"),console.log("loadWorkspace"),i.default.loadWorkspace(o.xml),console.log("loadWorkspace DONE");case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"loadCurrentProject",value:function(){var e=localStorage.getItem("currentID");null!==e?this.loadProject(Number(e)):this.newProject(),this.vm.emit("PROJECT_NAME_CHANGED")}},{key:"deleteProject",value:function(e){var t=this.getProjectIDs(),o=t.indexOf(e);o>-1&&t.splice(o,1);var c=Number(localStorage.getItem("currentID"));localStorage.removeItem("".concat(e,"_").concat("projectXml")),localStorage.removeItem("".concat(e,"_").concat("projectName")),localStorage.removeItem("".concat(e,"_").concat("projectTimestamp")),localStorage.removeItem("".concat(e,"_").concat("projectImgData")),localStorage.setItem("projectIDs",t),c===e&&(localStorage.removeItem("currentID"),this.vm.emit("PROJECT_NAME_CHANGED"))}},{key:"getProjectName",value:function(e){return localStorage.getItem("".concat(e,"_").concat("projectName"))}},{key:"getCurrentProjectName",value:function(){var e=Number(localStorage.getItem("currentID"));return 0==e?"Unsaved Project":this.getProjectName(e)}},{key:"changeProjectName",value:function(e,t){localStorage.getItem("".concat(e,"_").concat("projectName"))!=t?(localStorage.setItem("".concat(e,"_").concat("projectName"),t),localStorage.setItem("".concat(e,"_").concat("projectTimestamp"),new Date),this.vm.emit("PROJECT_NAME_CHANGED")):console.log("Names Are Equal, No Changes")}}]),e}();t.default=new v}}]);